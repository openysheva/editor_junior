<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playground</title>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script crossorigin src="//unpkg.com/react-is/umd/react-is.production.min.js"></script>
    <script crossorigin src="//unpkg.com/styled-components/dist/styled-components.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.2.0/react-router-dom.min.js"></script>
</head>

<body>
    <div id="app"></div>
</body>

<script>
    window['react'] = window.React;
    window['react-dom'] = window.ReactDOM;
    window['react-router-dom'] = window.ReactRouterDOM;
    window['styled-components'] = window.styled;

    const result1 = "XIX,MCMXC,MMVIII";
    const result2 = "1011,611,910";
    const result3 = "140,33,666";
    const result4 = "17,15,0";
    const result5 = "theStealthWarrior,isFirstAnswerCorrect,aBC";
    const result6 = "valid,invalid,invalid";
    const result7 = "1,-1,51";
    const result8 = "0,2000,15270";
    const result9 = "3,2,160";
    const result10 = "BegILifeTo,BrainsModeratelyPizza,LongerLongestShort";
    const result11 = "2,2,4";
    const result12 = "1,3,100";
    const result13 = "3,6,10,4";
    const result14 = "117,72";
    const result15 = "true,false,false";

    const openSpace1 = [
        true,  true,  true,  false,
        true,  true,  true,  true,
        true,  false, true,  false,
        true,  false, false, true,
        true,  true,  true,  true,
        false, false, true,  true 
    ];

    const openSpace2 = [
        false,  true,  false,  false,
        true,  true,  true,  true,
        true,  false, true,  false,
        true,  false, false, true,
        true,  true,  true,  true,
        false, false, true,  true 
    ];

    const openSpace3 = [
        false,  false,  false,  false,
        false,  false,  false,  false,
        false,  false, false,  false,
        false,  false, false, false,
        false,  false,  false,  false,
        false, false, false,  false 
    ];

    const checkAnswers = ({
        task1,
        task2,
        task3,
        task4,
        task5,
        task6,
        task7,
        task8,
        task9,
        task10,
        task11,
        task12,
        task13,
        task14,
        task15
    }) => {
        const correctAnswers = [];
        const isFirstCorrect = task1 ? ([task1(19), task1(1990), task1(2008)] || []).join(',') === result1 : false;

        if (isFirstCorrect) {
            correctAnswers.push(1);
        }

        const isSecondConrrect = task2 ?
            [
                task2(["A4Y", "A4Y"])?.join(''),
                task2(["A4R", "A6R", "A8R", "A10R", "A11R"])?.join(''),
                task2(["A4Y", "A5R", "B5R", "A4Y", "B6Y"])?.join('')
            ].join(',') === result2 : false;

        if (isSecondConrrect) {
            correctAnswers.push(2);
        }

        const isThirdCorrect = task3
            ? [
                task3(60, "De", "F"), 
                task3(373.15, "K",  "N"),
                task3(666, "K",  "K")
            ].join(',') === result3
            : false;

        if (isThirdCorrect) {
            correctAnswers.push(3);
        }

        const isFourthCorrect = task4
            ? [
                task4(openSpace1),
                task4(openSpace2),
                task4(openSpace3)
            ].join(',') === result4
            : false;

        if (isFourthCorrect) {
            correctAnswers.push(4);
        }

        const isFifthCorrect = task5
            ? [
                task5("the-stealth-warrior"), 
                task5("is-first-answer-correct"),
                task5("A-B-C")
            ].join(',') === result5
            : false;

        if (isFifthCorrect) {
            correctAnswers.push(5);
        }

        const isSixCorrect = task6
            ? [
                task6("A man, a plan, a canal: Panama"), 
                task6("Happy New Year"),
                task6("Abba Zabba, you're my only friend")
            ].join(',') === result6
            : false;

        if (isSixCorrect) {
            correctAnswers.push(6);
        }

        const isSevenCorrect = task7
            ? [
                task7(89, 1), 
                task7(92, 1),
                task7(46288, 3)
            ].join(',') === result7
            : false;

        if (isSevenCorrect) {
            correctAnswers.push(7);
        }

        const isEightCorrect = task8
            ? [
                task8(1, 10, 10), 
                task8(2, 20, 25),
                task8(11, 15, 30)
            ].join(',') === result8
            : false;

        if (isEightCorrect) {
            correctAnswers.push(8);
        }

        const isNineCorrect = task9
            ? [
                task9([2,6,8,10,3]), 
                task9([1, 2, 3]),
                task9([160, 3, 1719, 19, 11, 13, 21])
            ].join(',') === result9
            : false;

        if (isNineCorrect) {
            correctAnswers.push(9);
        }

        const isTenCorrect = task10
            ? [
                task10(["Beg", "Life", "I", "To"])?.join(''), 
                task10(["Moderately", "Brains", "Pizza"])?.join(''),
                task10(["Longer", "Longest", "Short"])?.join('')
            ].join(',') === result10
            : false;

        if (isTenCorrect) {
            correctAnswers.push(10);
        }

        const isElevenCorrect = task11
            ? [
                task11(10), 
                task11(12),
                task11(25)
            ].join(',') === result11
            : false;

        if (isElevenCorrect) {
            correctAnswers.push(11);
        }

        const isTwelveCorrect = task12
            ? [
                task12(3,1,7,3,10), 
                task12(4,2,7,3,30),
                task12(3,1,7,3,1000)
            ].join(',') === result12
            : false;

        if (isTwelveCorrect) {
            correctAnswers.push(12);
        }

        const isThirteenCorrect = task13
            ? [
                task13(1, 2, "add"), 
                task13(8, 2, "subtract"),
                task13(5, 2, "multiply"),
                task13(8, 2, "divide"),
            ].join(',') === result13
            : false;

        if (isThirteenCorrect) {
            correctAnswers.push(13);
        }

        const isFourteenCorrect = task14
            ? [
                task14([
                    { tier: 4, discount: 20 },
                    { tier: 2, discount: 30 },
                    { tier: 3, discount: 10 }
                ], 100, 130), 
                task14([
                    { tier: 2, discount: 50 },
                    { tier: 4, discount: 30 },
                    { tier: 3, discount: 20 }
                ], 50, 90),
            ].join(',') === result14
            : false;

        if (isFourteenCorrect) {
            correctAnswers.push(14);
        }

        const isFifeteenCorrect = task15
            ? [
                task15(['n','s','n','s','n','s','n','s','n','s']), 
                task15(['w','e','w','e','w','e','w','e','w','e','w','e']),
                task15(['w'])
            ].join(',') === result15
            : false;

        if (isFifeteenCorrect) {
            correctAnswers.push(15);
        }

        return correctAnswers;
    };

    const getSuccessAlert = (newSuccessContainer, correctAnswer) => {
        const successAlert = document.createElement('p');
        successAlert.innerHTML = `Ð’Ñ‹ Ð²ÐµÑ€Ð½Ð¾ Ñ€ÐµÑˆÐ¸Ð»Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ñƒ â„– ${correctAnswer} ðŸ¤ŒðŸ»`;
        successAlert.style.borderRadius = '8px';
        successAlert.style.padding = '16px 24px';
        successAlert.style.color = '#008e7d';
        successAlert.style.backgroundColor = '#e8f7f4';
        successAlert.style.width = '280px';
        successAlert.style.textAlign = 'center';
        successAlert.style.fontFamily = 'sans-serif';

        newSuccessContainer.appendChild(successAlert);
    }

    const listener = (e) => {
        if (e.key === 'script') {
            try {
                fetch(e.newValue)
                    .then(response => response.text())
                    .then(code => eval(code))
                    .then(() => {
                        const result = checkAnswers(window['exercise']);
                        const rightContainer = document.getElementById('right-container');
                        const successContainer = document.getElementById('success-alert-container');
                        successContainer?.remove();
                        const newSuccessContainer = document.createElement('div');
                        newSuccessContainer.id = 'success-alert-container';
                        rightContainer.appendChild(newSuccessContainer);


                        for (correctAnswer in result) {
                            console.log(correctAnswer)
                            getSuccessAlert(newSuccessContainer, result[correctAnswer]);
                        }
                    })
                    .catch(console.log);
            }
            catch { }
        }
    }
    listener({
        key: 'script', newValue: localStorage.getItem('script')
    });

    const updateNavigationText = () => window.top.postMessage(JSON.stringify(location));
    updateNavigationText();

    const pushState = history.pushState;
    history.pushState = (...args) => {
        pushState.apply(history, args);
        updateNavigationText();
    };

    window.addEventListener('storage', listener);
    window.addEventListener('popstate', updateNavigationText);

</script>

</html>